#В данном коде я использовал контекстный менеджер для открытия файла в формате csv.
#Для упрощенной работы с этим форматом использовался модуль csv, а конкретнее объект DictReader для обращения по ключам.

import csv


def fl(num: str) -> float:
    """Функция приводит строку вида '23,53' к значение флоат"""

    return float(num.replace(',', '.'))

with open('Data.csv', encoding='utf-8') as file:
    rows = csv.DictReader(file, delimiter=',', quotechar='"')

    #Считываю весь DictReader объект в переменную рес, для более простого прохода по нему.
    res = [i for i in rows]

    #Продукт с наибольшей выручкой. Задание 2
    revenue = max([(i['Название продукта'], fl(i['Выручка'])) for i in res], key=lambda x: x[1])

    #Расчет общей суммы выручки. Задание 3
    sum_revenue = round(sum([fl(i['Выручка']) for i in res]), 2)

    #Средняя стоимость продажи продукта. Задание 4
    sred_cost = [(i['Название продукта'], fl(i['Итоговая стоимость']) / fl(i['Количество'])) for i in res]

    #Процентная прибыль по каждой продаже и средний процент прибыли. Задание 5
    profit = [round(((fl(i['Цена продажи']) - fl(i['Себестоимость'])) / fl(i['Себестоимость'])) * 100, 2) for i in res]
    sred_profit = round(sum(profit) / len(profit), 2)

    #Списки покупателей разделенных по полу. Задание 6
    male = [i for i in res if i['Имя покупателя'] in ('Алексей', 'Иван', 'Андрей', 'Петр', 'Денис')]
    female = [i for i in res if i['Имя покупателя'] in ('Екатерина', 'Мария', 'Ольга', 'Анна', 'Юлия')]

    #Общая сумма выручки для мужчин и средняя стоимость продажи
    sred_male_cost = sum([fl(i['Выручка']) for i in male])
    sred_profit_male = sum([fl(i['Итоговая стоимость']) / fl(i['Количество']) for i in male])
    # Общая сумма выручки для женщин и средняя стоимость продажи
    sred_female_cost = sum([fl(i['Выручка']) for i in female])
    sred_profit_female = round(sum([fl(i['Итоговая стоимость']) / fl(i['Количество']) for i in female]), 2)

    #Список продуктов, у которых себестоимость превышает среднюю себестоимость. Задание 7
    sred_cost = sum([fl(i['Себестоимость']) for i in res]) / len(res)   #Средняя себестоимость
    product_list = [i['Название продукта'] for i in res if fl(i['Себестоимость']) > sred_cost]

    #Рассчитать общую стоимость производства. Т.к Такого столбца нет. Посчитаю общую себестоимость всех товаров
    sum_cost_price = sum([fl(i['Себестоимость']) for i in res])

#Вывод в соответствии с заданием

print(f'Продукт с наибольшей выручкой: {revenue[0]}; Выручка: {revenue[1]}')
print(f'Общая сумма выручки: {sum_revenue}')
print(f'Средняя стоимость продажи продукта: {sred_cost}')
print(f'Процентная прибыль по каждой продаже: {", ".join(map(str, profit))}; Средний процент прибыли: {sred_profit}')
print(f'Сумма выручки для мужчин: {sred_male_cost}; Средняя стоимость продажи: {sred_profit_male}')
print(f'Сумма выручки для женщин: {sred_female_cost}; Средняя стоимость продажи: {sred_profit_female}')
print(f'Список продуктов у которых себестоимость превышает среднюю себестоимость: {product_list}')
print(f'Общая себестоимость всех товаров: {sum_cost_price}')
